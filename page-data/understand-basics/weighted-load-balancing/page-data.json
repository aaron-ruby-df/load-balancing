{"componentChunkName":"component---src-components-mdx-custom-renderer-js","path":"/understand-basics/weighted-load-balancing","result":{"data":{"mdx":{"id":"7e75c442-da7c-55f9-b266-ae25950a768d","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"order\": 14\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h1\", {\n    \"id\": \"weighted-load-balancing\"\n  }, \"Weighted load balancing\"), mdx(\"h2\", {\n    \"id\": \"overview\"\n  }, \"Overview\"), mdx(\"p\", null, \"Weighted load balancing allows the user to set a relative weight for each origin server in a pool. These weights determine the percentage of traffic sent to available origins within a pool. If an origin becomes unhealthy, traffic will be rebalanced to the remaining available origins according to their respective weights.\"), mdx(\"hr\", null), mdx(\"h2\", {\n    \"id\": \"important-notes\"\n  }, \"Important notes\"), mdx(\"p\", null, \"When working with origin weights, note the following:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"The value of each origin weight must be between 0 and 1\"), \", and the weight must be expressed in increments of 0.01 (a weight of 0.015 is not valid).\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"The default weight is 1\"), \".\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"The percentage of traffic to send to a pool\"), \" is calculated as follows:\"), mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Percent traffic to send to pool = origin weight for pool \\xF7 sum of available weights\"))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Two pools with the same origin weights will receive the same traffic distribution\"), \".\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"If you do not enter weights, all origins will default to a weight of 1\"), \", distributing traffic equally among the active origins.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"When enabled, session affinity can affect traffic distribution\"), \", since established sessions are not reset when origin weights are modified.\"))), mdx(\"p\", null, \"No traffic is sent to a Load Balancer origin of 0 weight except under the following conditions:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The origin is used in multiple pools and has multiple weights assigned.  Check the origin in the Cloudflare Traffic App or via the List Pools API to confirm.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Health Checks are still sent at the expected interval for a 0-weight origin.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Grey-clouded Load Balancers support weights; however, DNS resolvers may cache resolved IPs for clients.\")), mdx(\"hr\", null), mdx(\"h2\", {\n    \"id\": \"origin-weights-example\"\n  }, \"Origin weights example\"), mdx(\"p\", null, \"Here\\u2019s an example applying weights to three origin servers:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Weights:\"), \" Origin Server A = 0.25; Origin Server B = 0.25; Origin Server C = 0.50\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"When all origins are healthy\"), \", each origin will receive the following proportion of total traffic: A = 25%; B = 25%; C = 50%.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"When one origin is unhealthy\"), \" (such as origin C), each healthy origin will receive the following proportion of total traffic: A = 50%; B=50%.\")), mdx(\"p\", null, \"A significant amount of traffic is required for the distribution to converge on the expected values.\"), mdx(\"hr\", null), mdx(\"h2\", {\n    \"id\": \"configuring-weights-from-the-load-balancing-dashboard\"\n  }, \"Configuring weights from the Load Balancing dashboard\"), mdx(\"p\", null, \"Users can configure origin weights when they set up a load balancer or from the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Load Balancing\"), \" dashboard in the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Traffic\"), \" app.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1382px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/load-balancing/static/f0e1cfd0792ab1ef11a615aaac5beb83/ddb6a/weighted-load-balancing-1.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"87.57225433526011%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAAsSAAALEgHS3X78AAAB+UlEQVQ4y5VTy27bMBDU/58K9F8K9NCm7bWHIEhqW26iFLast0TxTZGS3CHlGE4KtO5gJVDLHe7ucBUx0sIUp11d9m0lGJnn4z+htbbWRl8espuH7OuquDktym9xm3VydNaY4S+Y5znq5JSSIWeOmmNO7XMtd41SxmmlhJDGmHEcpZRCCBCmaVJKIe0cyovKPGvqKkv3ZZFxRo//gyjzOODJ87woiq7r2rYty7ILqKqqrmt4Fn/f9/AgM0rw5N1ul6YpmIcArPf7/XLWsrU4F2CNLc451PLkpR8TxDF/4OxcWtXaLJ1DCE9GJSgShznn7AXCl+e+vO3oTiEIxlmezLlAM5RSpDmbVlZJa/Q0mHkxOCmXQmqjfRWoxZMJIU3ThIrMYkrJolpVzZ1Qj8okwZ44b9K8zqua0h7x6HTJzAnp3QWQuCX3Qt0PY2zcJthKqlYr0xMCWhzHpOtOZEbfkIeeoCsLUZw7mZSaC+Fvj7Lvd3FeBzJFzz2Dimep0I8QXKNvO5xNeehwL/p5X5Qd92QhFWGSS6kuAAXUa8BDKWOM/ti167RzNsy2l06rt7GvgVlAORie56ef7z5s3n/c4ko8GdftxtFdAUSGqcQvMR3nMJ7QHSrw64DIumkeD22Se0q0Xq+32211BfCHJEmyjTefbpPPt7/g+Q1XSgAqplFcGQAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"weighted load balancing 1\",\n    \"title\": \"weighted load balancing 1\",\n    \"src\": \"/load-balancing/static/f0e1cfd0792ab1ef11a615aaac5beb83/f868f/weighted-load-balancing-1.png\",\n    \"srcSet\": [\"/load-balancing/static/f0e1cfd0792ab1ef11a615aaac5beb83/8f77f/weighted-load-balancing-1.png 346w\", \"/load-balancing/static/f0e1cfd0792ab1ef11a615aaac5beb83/e185b/weighted-load-balancing-1.png 691w\", \"/load-balancing/static/f0e1cfd0792ab1ef11a615aaac5beb83/f868f/weighted-load-balancing-1.png 1382w\", \"/load-balancing/static/f0e1cfd0792ab1ef11a615aaac5beb83/ddb6a/weighted-load-balancing-1.png 1592w\"],\n    \"sizes\": \"(max-width: 1382px) 100vw, 1382px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"hr\", null), mdx(\"h2\", {\n    \"id\": \"configuring-weights-via-the-cloudflare-api\"\n  }, \"Configuring weights via the Cloudflare API\"), mdx(\"p\", null, \"Origin weight is a property of origin server objects, which are associated with pools. To configure the weight of an origin server with the Cloudflare API, use the Update Pools command to set the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"weight\"), \" property of the origin.\"), mdx(\"p\", null, \"The example below uses the Update Pools command\\u2014\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"POST /user/load_balancers/pools\"), \"\\u2014to create a pool named \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"examplepool\"), \" and set weights for each of three origins.\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Request (curl)\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"curl -X POST \\\"https://api.cloudflare.com/client/v4/user/load_balancers/pools\\\" \\\\\\n     -H \\\"X-Auth-Email: user@example.com\\\" \\\\\\n     -H \\\"X-Auth-Key: c2547eb745079dac9320b638f5e225cf483cc5cfdda41\\\" \\\\\\n     -H \\\"Content-Type: application/json\\\" \\\\\\n--data '{\\n   \\\"description\\\":\\\"Primary data center - Provider XYZ\\\",\\n   \\\"name\\\":\\\"primary-dc-1\\\",\\n   \\\"enabled\\\":true,\\n   \\\"minimum_origins\\\":2,\\n   \\\"monitor\\\":\\\"f1aba936b94213e5b8dca0c0dbf1f9cc\\\",\\n   \\\"origins\\\":[\\n      {\\n        \\\"name\\\": \\\"server-a\\\",\\n        \\\"address\\\": \\\"0.0.1.0\\\",\\n        \\\"weight\\\": 0.25\\n       },\\n       {\\n         \\\"name\\\": \\\"server-b\\\",\\n         \\\"address\\\": \\\"0.0.2.0\\\",\\n         \\\"weight\\\": 0.25\\n       },\\n       {\\n         \\\"name\\\": \\\"server-c\\\",\\n         \\\"address\\\": \\\"0.0.3.0\\\",\\n         \\\"weight\\\": 0.50\\n       }\\n   ]\\n}'\\n\")), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Response\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-json\"\n  }, \"{\\n  \\\"success\\\": true,\\n  \\\"errors\\\": [],\\n  \\\"messages\\\": [],\\n  \\\"result\\\": {\\n    \\\"id\\\": \\\"17b5962d775c646f3f9725cbc7a53df4\\\",\\n    \\\"created_on\\\": \\\"2014-01-01T05:20:00.12345Z\\\",\\n    \\\"modified_on\\\": \\\"2014-01-01T05:20:00.12345Z\\\",\\n    \\\"description\\\": \\\"Primary data center - Provider XYZ\\\",\\n    \\\"name\\\": \\\"primary-dc-1\\\",\\n    \\\"enabled\\\": true,\\n    \\\"minimum_origins\\\": 2,\\n    \\\"monitor\\\": \\\"f1aba936b94213e5b8dca0c0dbf1f9cc\\\",\\n    \\\"check_regions\\\": [\\n      \\\"WEU\\\",\\n      \\\"ENAM\\\"\\n    ],\\n \\\"origins\\\":[\\n      {\\n        \\\"name\\\": \\\"server-a\\\",\\n        \\\"address\\\": \\\"0.0.1.0\\\",\\n        \\\"weight\\\": 0.25\\n       },\\n       {\\n         \\\"name\\\": \\\"server-b\\\",\\n         \\\"address\\\": \\\"0.0.2.0\\\",\\n         \\\"weight\\\": 0.25\\n       },\\n       {\\n         \\\"name\\\": \\\"server-c\\\",\\n         \\\"address\\\": \\\"0.0.3.0\\\",\\n         \\\"weight\\\": 0.50\\n       }\\n   ]\\n}\\n\")));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"demo":null,"difficulty":null,"summary":null,"tags":null,"title":"","type":null,"updated":null}}},"pageContext":{"id":"7e75c442-da7c-55f9-b266-ae25950a768d","fields":{"slug":"/understand-basics/weighted-load-balancing"},"frontmatter":{"title":"","type":null,"order":14,"hidden":null,"hideChildren":null,"breadcrumbs":null},"headings":[{"value":"Weighted load balancing","depth":1}],"tableOfContents":{"items":[{"url":"#weighted-load-balancing","title":"Weighted load balancing","items":[{"url":"#overview","title":"Overview"},{"url":"#important-notes","title":"Important notes"},{"url":"#origin-weights-example","title":"Origin weights example"},{"url":"#configuring-weights-from-the-load-balancing-dashboard","title":"Configuring weights from the Load Balancing dashboard"},{"url":"#configuring-weights-via-the-cloudflare-api","title":"Configuring weights via the Cloudflare API"}]}]},"parent":{"modifiedTime":"2021-02-18","relativePath":"understand-basics/weighted-load-balancing.md"}}},"staticQueryHashes":["1302537747","2814688963","32046230","338033027","811020565"]}